# DGMD E-14 Final Project - OCR
This project contains Python scripts related to the OCR portion of the pill matching final project for DGMD E-14.  
It includes testing for both the keras-ocr and EasyOCR libraries.

## Requirements
Some libraries are required to run any of the scripts, while some are only required for the particular OCR library.

### Shared
These libraries will be used by prediction or test scripts for both OCR models.

* imutils (image manipulation utilities)
* levenshtein (string distance calculation)
* numpy
* pandas
* opencv-python/opencv-python-headless

Note that if opencv-python is installed, both will install opencv-python-headless as well.

### EasyOCR
EasyOCR requires PyTorch.  This includes torch, torchaudio, and torchvision.  If running on Windows, PyTorch must 
be installed first.

* torch
* torchaudio
* torchvision
* easyocr

### keras-ocr
keras-ocr requires TensorFlow.  It's probably best to pre-install this to ensure you get the appropriate version for
CPU vs GPU, and to ensure you have any additional pre-requisites for TensorFlow itself.  
https://www.tensorflow.org/install

* tensorflow (this is the GPU version, for CPU-only use tensorflow-cpu - follow install instructions)
* keras-ocr

## Usage/Scripts
For each OCR library, there's an associated "X_predict.py" and "X_accuracy.py" module.  There's an additional 
"test_utils.py" module containing functions shared across both "X_accuracy.py" modules.

### X_predict.py
This module contains functions used to generate predictions from an image file using the specific OCR library.

The `generate_ocr()` function should be called first, to create the OCR object that will be used to do the predictions.  
This is done separately from the actual `generate_predictions()` function to facilitate reuse for batch testing.

The `generate_ocr()` function may or may not take arguments - check the specific module.

The `generate_predictions()` function has the same signature for both:  
```python
def generate_predictions(ocr, image_file: str, rotate=False) -> List[List[str]]:
```
This function takes the OCR object generated by `generate_ocr()`, the path to the image file for which OCR predictions 
should be generated, and an optional flag indicating whether additional permutations of the image should be generated 
at 90, 180, and 270 degree rotations.  (This flag is mainly intended for use with batch testing of provided test images, 
which may be in different orientations - it defaults to False.)

Each permutation will result in a List of predicted "words" in the image.  The function returns a List containing all 
of these Lists, one per permutation.  At minimum, there will be two permutations, one for the original image and one 
for a sharpened version of the image.  If rotate is True, there will be eight permutations, one for each orientation of
original and sharpened image version.

### test_utils.py
This module contains a bunch of functions useful for batch testing accuracy of the models.

### X_accuracy.py
This module contains the batch prediction generation and accuracy calculations for each OCR library.

It assumes that there will be a CSV file provided with the format:  
(C3PI directory), (Image file name), (imprint rating), "(imprint text)"

To run against different text files, or with different sampling settings, modify the text_file and 
`utils.sample_images()` settings appropriately.
